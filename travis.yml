language: python
python:
  - 3.6

os:
  - linux


# This is for the IO layer larcv, and to enable lsf:

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install python swig cmake hdf5 openmpi; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install cmake libhdf5-serial-dev python-dev swig3.0 openmpi-bin libopenmpi-dev; fi
  - echo -e "machine github.com\n  login $GITHUB_TOKEN" > ~/.netrc
  - git lfs pull

install:
  - pip install scikit-build
  - pip install mpi4py
  - echo $PYTHONPATH
  - echo $LD_LIBRARY_PATH
  # - python setup.py install


branchs:
  only:
    - master

script: 
  - pytest -m "not distributed_test" tests/
  - mpiexec -n 2 pytest -m distributed_test tests/